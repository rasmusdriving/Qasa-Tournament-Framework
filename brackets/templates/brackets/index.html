<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Tracker</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a2e;
            color: #e6e6e6;
            font-family: 'Inter', sans-serif;
        }

        .bracket-container {
            display: flex;
            overflow-x: auto;
            padding: 2rem;
            gap: 3rem;
            min-height: 600px;
            align-items: stretch;
        }

        .round-column {
            display: flex;
            flex-direction: column;
            min-width: 320px;
            gap: 2rem;
        }

        .round-header {
            text-align: center;
            padding: 1rem;
            background: linear-gradient(135deg, #2a2a5a 0%, #16213e 100%);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .match-card {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .match-card:hover {
            transform: translateY(-4px);
        }

        .team-container {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .team-info {
            flex-grow: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-name {
            font-weight: 600;
            color: #e6e6e6;
        }

        .team-score {
            font-size: 1.25rem;
            font-weight: 700;
            color: #4CAF50;
            min-width: 2.5rem;
            text-align: center;
        }

        .match-connector {
            position: absolute;
            right: -3rem;
            width: 3rem;
            height: 2px;
            background: #4CAF50;
            top: 50%;
        }

        .match-status {
            position: absolute;
            top: -0.75rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 1;
        }

        .status-ongoing {
            background: #f44336;
            color: white;
            animation: pulse 2s infinite;
        }

        .status-completed {
            background: #4CAF50;
            color: white;
        }

        .bye-match {
            opacity: 0.6;
        }

        .winner-indicator {
            position: absolute;
            right: -0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 0.5rem;
            height: 0.5rem;
            background: #4CAF50;
            border-radius: 50%;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }

            100% {
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .bracket-container {
                padding: 1rem;
                gap: 1.5rem;
            }

            .round-column {
                min-width: 280px;
            }
        }
    </style>
</head>

<body>
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold mb-8 text-center text-purple-400">Tournament Tracker</h1>

        {% if tournament %}
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-center text-gray-300">{{ tournament.name }}</h2>
            <p class="text-center text-gray-400 mt-2">{{ tournament.description }}</p>
        </div>

        <div id="bracket" class="bracket-container">
            <!-- Bracket will be populated by JavaScript -->
        </div>

        <script>
            function updateBracket() {
                $.getJSON("/tournament/{{ tournament.id }}/bracket", function (data) {
                    const bracket = $("#bracket");
                    bracket.empty();

                    if (data.message) {
                        bracket.append(`<p class="text-xl text-center text-gray-300">${data.message}</p>`);
                        return;
                    }

                    data.bracket.forEach((round, roundIndex) => {
                        const roundColumn = $('<div class="round-column"></div>');
                        const roundName = round.name || `Round ${round.round_number}`;

                        roundColumn.append(`
                            <div class="round-header">
                                <h3 class="text-xl font-semibold">${roundName}</h3>
                            </div>
                        `);

                        round.matches.sort((a, b) => a.position - b.position);

                        round.matches.forEach(match => {
                            const matchCard = $(`
                                <div class="match-card ${match.is_bye ? 'bye-match' : ''}">
                                    ${match.is_ongoing ? '<div class="match-status status-ongoing">LIVE</div>' : ''}
                                    ${match.winner ? '<div class="match-status status-completed">COMPLETED</div>' : ''}
                                    ${match.is_bye ? `
                                        <div class="text-center text-gray-400 py-4">
                                            <p class="font-semibold">BYE</p>
                                            <p class="text-sm mt-2">${match.bye_description || ''}</p>
                                        </div>
                                    ` : `
                                        <div class="team-container">
                                            <div class="team-info">
                                                <span class="team-name">${match.team1 || 'TBD'}</span>
                                                <span class="team-score">${match.team1_score}</span>
                                            </div>
                                            ${match.winner === match.team1 ? '<div class="winner-indicator"></div>' : ''}
                                        </div>
                                        <div class="team-container">
                                            <div class="team-info">
                                                <span class="team-name">${match.team2 || 'TBD'}</span>
                                                <span class="team-score">${match.team2_score}</span>
                                            </div>
                                            ${match.winner === match.team2 ? '<div class="winner-indicator"></div>' : ''}
                                        </div>
                                    `}
                                    ${roundIndex < data.bracket.length - 1 ? '<div class="match-connector"></div>' : ''}
                                </div>
                            `);

                            roundColumn.append(matchCard);
                        });

                        bracket.append(roundColumn);
                    });
                });
            }

            $(document).ready(function () {
                updateBracket();
                setInterval(updateBracket, 5000); // Update every 5 seconds
            });
        </script>

        <div class="mt-8 text-center">
            <a href="/betting" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                View Betting Details
            </a>
        </div>
        {% else %}
        <div class="bg-gray-800 shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <p class="text-xl text-center text-gray-300">There is no active tournament at the moment.</p>
        </div>
        {% endif %}
    </div>
</body>

</html>